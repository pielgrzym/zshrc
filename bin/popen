#!/bin/zsh

WORKDIR=$HOME/work

function startp_session () {
        cd $1
        gvim -S $2 &
        PIEL_PROJ=$PROJ PIEL_PROJ_DIR=$PROJDIR/git urxvtc &
        PIEL_PROJ=$PROJ PIEL_PROJ_DIR=$PROJDIR/git urxvtc
}

function startp () {
        cd $1
        gvim &
        PIEL_PROJ=$PROJ PIEL_PROJ_DIR=$PROJDIR/git urxvtc &
        PIEL_PROJ=$PROJ PIEL_PROJ_DIR=$PROJDIR/git urxvtc
}

if [[ -n $1 ]]; then
        PROJ=$1
        PROJDIR=$WORKDIR/$PROJ
else
        PROJ=$(ls -1 $HOME/work|dmenu)
        PROJDIR=$WORKDIR/$PROJ
        if [[ -z $PROJ ]]; then
                echo "No project given"
                exit 1
        fi
fi

# if project dir exists and has git subdir
if [[ -d $PROJDIR && -d $PROJDIR/git ]]; then
        if [[ -r $PROJDIR/git/Session.vim ]]; then
                startp_session $PROJDIR/git "Session.vim"
        elif [[ -r $PROJDIR/git/$PROJ.vim ]]; then
                startp_session $PROJDIR/git $PROJ.vim
        else
                startp $PROJDIR/git
        fi
else
        exit 1
fi
