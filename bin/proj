#!/bin/zsh
eval "$(rbenv init - zsh)"

sysproj(){
        name=$1
        proj_path=$2
        if [[ ! -d $proj_path ]]; then
                echo "No such project: $name"
                continue;
        fi
        if [[ -f $HOME/.vimsessions/$name ]]; then
                sfile=$HOME/.vimsessions/$name
        fi
        rbenv shell $(rbenv global); 
        PROJECT=$name PROJECT_ROOT=$proj_path SESSION_FILE=$sfile teamocil tower
}

proj(){
        for name in "$@"; do
                if [[ $name == "zsh" ]]; then sysproj "zsh" $ZDOTDIR; continue; fi
                if [[ $name == "vim" ]]; then sysproj "vim" "$HOME/.vim"; continue; fi
                if [[ $name == "tmux" ]]; then sysproj "tmux" "$HOME/.common"; continue; fi
                proj_path=$HOME/${my_project_dir:=work}/$name/git
                if [[ ! -d $proj_path ]]; then
                        echo "No such project: $name"
                        continue;
                fi
                if [[ -f $HOME/.vimsessions/$name ]]; then
                        sfile=$HOME/.vimsessions/$name
                fi
                rbenv shell $(rbenv global); 
                PROJECT=$name PROJECT_ROOT=$proj_path SESSION_FILE=$sfile teamocil tower
        done
}

proj $@
